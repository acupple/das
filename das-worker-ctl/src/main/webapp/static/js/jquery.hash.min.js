(function(b){var k,c=window,h={hash:"",type:"?"},e=encodeURIComponent,q=decodeURIComponent,n=[],i={},p={},m={},l={"!":"/","?":"="},f={"!":"/","?":"&"},d=/^[^#]*/,r=/^(#[^#]*)(#?.*)$/,j=b.isArray,o=b.inArray,a=b.each;b.hash=function(t){if(b.type(t)==="string"){t={hash:t}}var s=b.extend({},h,t);s.hash=s.hash||c.location.hash;return new g(s)._parse()};b.hash.defaults=h;b(c).bind("hashchange",function(x){var B=x.originalEvent,u=b.hash(B.newURL).get(),w=b.hash(B.oldURL).get(),v={},y=[],A,t=[],s=[],z=[];a(u,function(C,D){if(w[C]!==D&&v[C]===k){v[C]={old:w[C],"new":D};y.push(C)}});a(w,function(C,D){if(u[C]!==D&&v[C]===k){v[C]={old:D,"new":u[C]};y.push(C)}});if(!(A=y.length)){return}a(y,function(E,C){var F,D;if(i[C]){a(i[C].callbacks,function(G,H){if(!~o(H,t)){t.push(H)}})}if(p[C]){a(p[C].callbacks,function(G,H){if(!~o(H,s)){s.push(H)}})}if(m[C]){F=m[C].keys;a(F,function(G,H){if(!~o(H,y)){D=!0;return !1}});if(!D){a(m[C].callbacks,function(G,H){if(!~o(H,z)){z.push(H)}})}}});a(t,function(C,D){D(u,w)});a(s,function(C,D){D(u,w)});a(z,function(C,D){D(u,w)});a(n,function(C,D){D(u,w)})});function g(s){this.options=s}g.prototype={_reset:function(){var s=this;s._equal=l[s._type];s._split=f[s._type]},_parse:function(){var v=this,u=v.options,y=u.hash,x,t={},s,w;y=y.replace(d,"");if(y[1]!=="!"&&y[1]!=="?"){v._type=u.type;v._reset();v._suffix="";v._result={};return v}x=y.match(r);v._hash=x[1];v._suffix=x[2];v._type=v._hash[1];v._reset();v._result=t;v._hash=v._hash.replace(/^[#!?\/]+/,"");s=v._hash.split(v._split);if(v._type==="!"){a(s,function(z,A){if(z%2){if(w){t[w]=q(A)}}else{w=A;if(A){t[A]=""}}})}else{if(v._type==="?"){a(s,function(A,z){var D=z.indexOf(v._equal),B=z.slice(0,D),C=q(z.slice(D+1));if(B){t[B]=C||""}})}}v._result=t;return v},stringify:function(u){var t=this,s=[];if(u==="!"||u==="?"){t._type=u;t._reset()}a(t._result,function(v,w){s.push(v+t._equal+e(w))});t._hash=t._type+s.join(t._split);return t._hash+t._suffix},location:function(s){if(this._hasChange){location.hash=this.stringify(s)}},set:function(t,w){var v={},u=this,s;if(w===k){v=t}else{v[t]=w}for(s in v){v[s]=""+v[s];if(u._result[s]!=v[s]){u._hasChange=!0;u._result[s]=v[s]}}return this},get:function(t){if(t===k){return this._result}var w=j(t),v=w?t:[t],s={},u=this;a(v,function(x,y){s[y]=u._result[y]});return w?s:s[t]},remove:function(s){if(s===k){this._result={};this.stringify();return}var v=j(s),u=v?s:[s],t=this;a(u,function(w,x){delete (t._result[x])});return this},listen:function(){var y=arguments,t=y.length,w=y[0],A=y[t-1],u=t===2&&j(w),s=t>2,z=t===1,v=!u&&!s&&!z,B=[],x;if(z){x=n}else{if(v){B=[w];x=i}else{if(s){B=[].slice.call(y,0,t-1);x=p}else{B=w;x=m}}}if(z){if(!~o(A,x)){x.push(A)}}else{a(B,function(F,E){if(x[E]===k){x[E]={}}if(B.length>1&&x[E].keys===k){x[E].keys=[]}if(x[E].callbacks==k){x[E].callbacks=[]}var D=x[E].keys,C=x[E].callbacks;if(x[E].keys){a(B,function(H,G){if(!~o(G,D)&&G!==E){D.push(G)}})}if(!~o(A,C)){C.push(A)}})}},suffix:function(t){var s=this;if(t===k){return s._suffix}s._suffix="#"+t;s.stringify();return s}}})(jQuery);